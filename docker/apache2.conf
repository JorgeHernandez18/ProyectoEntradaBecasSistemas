# Configuración Apache optimizada para el sistema de becarios

ServerRoot /etc/apache2
Listen 80

LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule php_module modules/libphp.so

<IfModule mod_php.c>
    AddType application/x-httpd-php .php
</IfModule>

<IfModule mod_dir.c>
    DirectoryIndex index.php index.html
</IfModule>

# Configuración del directorio raíz
DocumentRoot /var/www/html

<Directory /var/www/html>
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
    
    # Configuración para reescritura de URLs
    RewriteEngine On
    
    # Redirigir al index si no existe el archivo
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php [QSA,L]
</Directory>

# Configuración específica para uploads de fotos
<Directory /var/www/html/admin/assets/fotos_becarios>
    Options -Indexes
    AllowOverride None
    Require all granted
    
    # Solo permitir imágenes
    <FilesMatch "\.(jpg|jpeg|png|gif)$">
        Require all granted
    </FilesMatch>
    
    <FilesMatch "\.">
        Require all denied
    </FilesMatch>
</Directory>

# Configuración de tipos MIME
<IfModule mod_mime.c>
    TypesConfig /etc/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
    AddType text/html .shtml
    AddOutputFilter INCLUDES .shtml
</IfModule>

# Configuración de logs
ErrorLog /var/log/apache2/error.log
LogLevel warn
LogFormat "%h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" combined
CustomLog /var/log/apache2/access.log combined

# Configuración de rendimiento
<IfModule mod_mpm_prefork.c>
    StartServers 2
    MinSpareServers 2
    MaxSpareServers 10
    MaxRequestWorkers 150
    MaxConnectionsPerChild 0
</IfModule>